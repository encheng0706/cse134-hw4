<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Contact | Ethan Cheng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Jost" rel="stylesheet">
  <style>
    body {
      font-family: 'Jost', sans-serif;
      color: #36454F;
    }

    nav a {
      font-weight: bold;
      color:inherit;
      text-decoration: none;
    }

    #resume iframe {
      width: 50vw;
      max-width: 100%;
      height: 100vh;
    } 

    #resume-mobile {
      display: none;
    }

    custom-banner {
        display: flex;
        justify-content: flex-end;
    }

    custom-banner a {
      padding: 0px 0.3em;
    }

    #contact-info address,
    #contact-info a,
    #resume-mobile a {
      font-style: normal;
      font-weight: bold;
      color:inherit;
    }

    /*Tablet dimensions*/
    @media (max-width: 1024px) {
      body {
        font-size: 1.2em;
      }
      #resume iframe {
        width: 75vw;
        max-width: 100%;
        height: 75vh;
      } 

      #resume-mobile {
        display: none;
      }
    }

    /*Phone Dimensions*/
    @media (max-width: 480px) {

      body {
        font-size: 1.5em;
      }

      nav {
        display:flex;
        justify-content:flex-start;
        gap:0.25rem;
        font-size: 0.75em;
      }

      #resume {
        display: none;
      }

      #resume-mobile {
        display: flex;
      }

    } 
  </style>
</head>

<body>
  <header>
    <div id="menu" style="display: block;">
      <nav>
        <a href="index.html">Main</a>
        <b>|</b>
        <a href="work.html">Work</a> 
      </nav>
    </div>
  </header>

  <section id="contact-info">
    <h3>You can contact me through:</h3>

    <form id="contact-form" action="https://httpbin.org/post" method="post">
      <label for="name">
        <p>Name:</p>
        <input id="name" type="text" name="name" required minlength="0">
      </label>

      <label for="email">
        <p>Email:</p>
        <input id="email" type="email" name="email" required minlength="8">
      </label>

      <label for="message">
        <p>Message:</p>
        <textarea id="message" name="message" required maxlength="300"></textarea>
      </label>

      <br>
      <input type="hidden" name="possible_bot" value="true">
      <button type="submit">Send</button>

      <output id="error-output"></output>
      <output id="info-output"></output>
    </form>
  </section>
  <!--PC and tablet view-->
  <div id="resume">
    <strong>Resume:</strong><br>
    <iframe src="images/Resume08082023.pdf"></iframe>
  </div>
  <!--Mobile view-->
  <div id="resume-mobile">
    <a href="images/Resume08082023.pdf" download="EthanChengResume">Download My Resume Here</a>
  </div>
  <footer>
    <hr>
    <custom-banner>
      <a href="https://github.com/encheng0706/cse134-hw3">
        <img src="images/github-mark.png" width="21" alt="GitHub Repo">
      </a>
      <a href="https://www.linkedin.com/in/ethan-cheng-670206269/">
        <img src="images/LI-In-Bug.png" width="24" alt="GitHub Repo">
      </a>
    </custom-banner>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const form = document.getElementById("contact-form");
      const nameField = document.getElementById("name");
      const emailField = document.getElementById("email");
      const messageField = document.getElementById("message");
      const errorOutput = document.getElementById("error-output");
      const charCounter = document.getElementById("char-counter");
      const formErrorsInputted = document.getElementById("form-errors");

      let form_errors = [];

      const namePattern = /^[a-zA-Z\s'-]+$/;
      const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      const messagePattern = /^[a-zA-Z0-9 .,!?'\-]*$/;

      
      function errorMessage(message) {
        errorOutput.textContent = message;
        errorOutput.style.opacity = "1";
        setTimeout(() => {
          errorOutput.style.opacity = "0";
        }, 3000);
      }

      function validateField(field, pattern, errorMessage) {
        if (!pattern.test(field.value)) {
          field.setCustomValidity(errorMessage);
          field.classList.add("error-highlight");
          showError(errorMessage);
          form_errors.push({ field: field.name, message: errorMessage });

          setTimeout(() => field.classList.remove("error-highlight"), 500);
        } else {
          field.setCustomValidity("");
        }
      }

      /*backspace on invalid chars*/
      function invalidCharEnter(event, pattern, field) {
        if (!pattern.test(event.key) && event.key !== "Backspace") {
          event.preventDefault();
          field.classList.add("error-highlight");
          showError(`Invalid character: "${event.key}"`);
          setTimeout(() => field.classList.remove("error-highlight"), 500);
        }
      }

      nameField.addEventListener("keypress", (event) => invalidCharEnter(event, /^[a-zA-Z\s'-]$/, nameField));
      messageField.addEventListener("keypress", (event) => invalidCharEnter(event, /^[a-zA-Z0-9 .,!?'\-]$/, messageField));
      
      /*max length warning*/
      messageField.addEventListener("input", function() {
        let remaining = 300 - messageField.value.length;
        charCounter.textContent = `Characters remaining: ${remaining}`;
        charCounter.style.color = remaining <= 50 ? "orange" : "black";
        if (remaining <= 10) charCounter.style.color = "red";
        if (remaining < 0) {
          messageField.setCustomValidity("Message exceeds the character limit.");
          form_errors.push({ field: "message", message: "Exceeded character limit." });
        } else {
          messageField.setCustomValidity("");
        }
      });

      form.addEventListener("submit", function(event) {
        form_errors = [];
        validateField(nameField, namePattern, "No illegal characters.");
        validateField(emailField, emailPattern, "Email address is not valid.");
        validateField(messageField, messagePattern, "No illegal characters.");

        if (form_errors.length > 0) {
          event.preventDefault();
          showError("List of errors.");
          formErrorsInputted.value = JSON.stringify(form_errors);
        }
      });
      
    });
  </script>
</body>
